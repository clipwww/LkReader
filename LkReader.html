<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
		<!--width=device-width為適應各式裝置螢幕大小 initial-scale=1為初始比例-->
		<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
		<!--X-UA-Compatible設置IE兼容模式；有什麼最新的版本IE，就用什麼版本的標準模式。-->
		<meta name="description" content="MetroResume">
		<title>LK READER</title>
		<link href="css/reset.css" rel="stylesheet"> <!--ResetCSS-->	
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/LkReader.css" rel="stylesheet"><!--自己寫的css要最後一個讀取-->
		<script src="js/jquery-2.2.0.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			$(function(){
				var  mn = $(".navbar");
				mns = "navbar-fixed-top";

				$(window).scroll(function() {
					if( $(this).scrollTop() > $('header').height() ) {
						mn.addClass(mns); //當螢幕滾動下滑距離超過header的長度時就讓導覽列變成固定在頂端
						$("#main").css("padding-top","100px"); //因為導覽列變成fixed的 所以會多出導覽列的空位 增加間距
					}else{
						mn.removeClass(mns);
						$("#main").css("padding-top","50px");
					}
				});

				var LkHTML = " ";

				// find some demo xml - DuckDuckGo is great for this
				var URL = "https://www.lightnovel.cn/forum.php?mod=rss&fid=141&auth=0"
				// build the yql query. Could be just a string - I think join makes easier reading
				var yqlURL = [
			    	"http://query.yahooapis.com/v1/public/yql",
			        "?q=" + encodeURIComponent("select * from xml where url='" + URL + "'"),
			        "&format=json&callback=?"
			    ].join("");
				// Now do the AJAX heavy lifting  

			    $.getJSON(yqlURL, function(data){
			    	if(data.query.results === null ){
			    		$("#BOX").append('<h1>連線失敗惹<br/>(｡・ ω<)ゞ てへぺろ❤</h1><h1>應該是連線失敗，吧？<br/>不然就是其他某種可能的原因ㄏㄏ</h1><h1>總之</h1><h1>(´◓Д◔`) 哇幹!!<br/>( っค้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้้c )</h1>');
			    		return false;
			    	}
			        var Lk = data.query.results.rss.channel;

			        $.each(Lk.item, function(i, comData){	

			        	LkHTML += "<div class=\"col-sm-3\">";
			        	LkHTML += "<a href='"+ comData.link +"' targer='_blank'><div class='box'>";
			        	LkHTML += "<p>" + comData.title + "</p>";
			        	LkHTML += "</div></a></div>";

			        	$("#BOX").append(LkHTML);
			        		
			        	LkHTML=" ";

			        });//end each
			    });//end getJSON


			    $("#BOX").on({
			    	click: function(){
		    			    	var link = $(this).attr("href");
		    
		    					yqlURL = [
		    				    	"http://query.yahooapis.com/v1/public/yql",
		    				        "?q=" + encodeURIComponent("select * from html where url='" + link + "'"),
		    				        "&format=json&callback=?"
		    				    ].join("");	
		    					
		    					$("#BOX").text(" ");

		    				    $.getJSON(yqlURL,function(data){
		    				    	
		    				    	var imgLink = data.query.results.body.div[6].div[3].div[1].div[0].table.tbody.tr[0].td[1].div[1].div[1].div[0].table.tbody.tr.td;

		    				    	$.each(imgLink.img, function(i, Comic){
		    				    		imgSrc = Comic.file;
		    				    		LkHTML += "<img src='"+ imgSrc +"' alt=\"LK\" />";
		    				    	});//end each

		    				    	$("#BOX").append(LkHTML);
		    				    	LkHTML = " ";
		    				    	
		    				    });//end getJSON
		    				    return false;
			    			}
			    },"a")

			    $("#BOX").on({
			    	click: function(){
			    		var imgSrc = $(this).attr("src");
			    		$("#jumpImage img").attr("src", imgSrc);
			    		$("#jumpImage").fadeIn(500);

			    		$("#BOX img").each(function(i, data){	
			    			if( imgSrc === $(data).attr("src") ){
	    						$("#close").text("第 "+ (i+1) + " 頁。點我關閉。");
	    					}
			    		});
			    	}
			    }, "img");

			    var imgSrc2;
	    		$("#jumpImage span#next").click(function(){
	    			imgSrc = $("#jumpImage img").attr("src");
	    			$("#BOX img").each(function(i, data){

	    				if( imgSrc === $(data).attr("src") ){
	    					imgSrc2 = $(this).next().attr("src");
	    					$("#close").text("第 "+ (i+2) + " 頁。點我關閉。");

		    				if( imgSrc2 === undefined ){
		    					$("#jumpImage").fadeOut(500);
		    				}
	    				}
	    			});
				    $("#jumpImage img").attr("src", imgSrc2);
	   			});
	   			$("#jumpImage span#prev").click(function(){
	    			imgSrc = $("#jumpImage img").attr("src");
	    			$("#BOX img").each(function(i, data){

	    				if( imgSrc === $(data).attr("src") ){
	    					imgSrc2 = $(this).prev().attr("src");
	    					$("#close").text("第 "+ (i) + " 頁。點我關閉。");

		    				if( imgSrc2 === undefined ){
		    					$("#jumpImage").fadeOut(500);
		    				}
	    				}
	    			});
				    $("#jumpImage img").attr("src", imgSrc2);
	   			});

	   			$("#jumpImage button#close").click(function(){
	   				$("#jumpImage").fadeOut(500);
	   			});

			});
		</script>
	</head>
	<body>
		<header>
			<span class="glyphicon glyphicon-camera"> </span> LK輕之國度 Reader
			<p>Try Try See</p>
		</header>

		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navMenu">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">
						裝飾品導覽列XD
					</a>
				</div>	
				<!--以上為導覽列Header部分；以下為導覽列主體部分-->
				<div class="collapse navbar-collapse" id="navMenu">
					<ul class="nav navbar-nav">
						<li class="active">
							<a href="#" data-toggle="tab">MENU1</a>
						</li>
						<li>
							<a href="#" data-toggle="tab">MENU2</a>
						</li>
						<li>
							<a href="#" data-toggle="tab">MENU3</a>
						</li>						
					</ul>				
				</div>				
			</div>				
		</nav>

		<div id="main" >
			<div class="container">
			 	<div id="BOX">

			 	</div>
			</div>
		</div>

		<div id="jumpImage">
			<button id="close" class="btn btn-block" ></button>
			<span id="prev" class="glyphicon glyphicon-chevron-left" style="left:0px;top:50vh"></span>
			<img src=" " alt="jump!"/>
			<span id="next" class="glyphicon glyphicon-chevron-right" style="right:0px;top:50vh"></span>
		</div>		
	</body>
</html>